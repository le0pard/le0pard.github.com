---
layout: post
title: Элементарный Bash скрипт для резервного копирования данных
wordpress_id: 834
wordpress_url: http://leopard.in.ua/?p=834
---
Сделаем немного автоматизировать рутиную работу по подготовке бэкапов.В данном случае, мы не будем использовать мощные программы, или даже целые системы для резервного копирования данных, ограничимся самым доступным что у нас есть. А именно — Bash скриптом.<!--more-->## Что должен выполнять наш скрипт?
Бэкапить веб проект, а именно:— Делать резервную копию базы MySQL.— Делать резервную копию файлов.— Структурировать это.И так, вот наш скрипт:<pre lang="bash">#!/bin/bashPROJNAME= #Имя проектаCHARSET= #Кодировка базы данных (utf8)DBNAME= #Имя базы данных для резервного копированияDBFILENAME= #Имя дампа базы данныхARFILENAME= #Имя архива с файламиHOST= #Хост MySQLUSER= #Имя пользователя базы данныхPASSWD= #Пароль от базы данныхDATADIR= #Путь к каталогу где будут храниться резервные копииSRCFILES= #Путь к каталогу файлов для архивированияPREFIX=`date +%F` #Префикс по дате для структурирования резервных копий#start backupecho "[--------------------------------[`date +%F--%H-%M`]--------------------------------]"echo "[----------][`date +%F--%H-%M`] Run the backup script..."mkdir $DATADIR/$PREFIX 2&gt; /dev/nullecho "[++--------][`date +%F--%H-%M`] Generate a database backup..."#MySQL dumpmysqldump --user=$USER --host=$HOST --password=$PASSWD --default-character-set=$CHARSET $DBNAME &gt; $DATADIR/$PREFIX/$DBFILENAME-`date +%F--%H-%M`.sqlif [[ $? -gt 0 ]];thenecho "[++--------][`date +%F--%H-%M`] Aborted. Generate database backup failed."exit 1fiecho "[++++------][`date +%F--%H-%M`] Backup database [$DBNAME] - successfull."echo "[++++++----][`date +%F--%H-%M`] Copy the source code project [$PROJNAME]..."#Src dumptar -czpf $DATADIR/$PREFIX/$ARFILENAME-`date +%F--%H-%M`.tar.gz $SRCFILES 2&gt; /dev/nullif [[ $? -gt 0 ]];thenecho "[++++++----][`date +%F--%H-%M`] Aborted. Copying the source code failed."exit 1fiecho "[++++++++--][`date +%F--%H-%M`] Copy the source code project [$PROJNAME] successfull."echo "[+++++++++-][`date +%F--%H-%M`] Stat datadir space (USED): `du -h $DATADIR | tail -n1`"echo "[+++++++++-][`date +%F--%H-%M`] Free HDD space: `df -h /home|tail -n1|awk '{print $4}'`"echo "[++++++++++][`date +%F--%H-%M`] All operations completed successfully!"exit 0</pre>Запускать можно парой способов:— Простой запуск: ./backup.sh— Запуск + запись в лог: ./backup.sh | tee backup.log— а еще его можно в cron запихать: 00 20 * * 7 root sh /home/bond/backup.sh | tee /home/bond/backup/backup.logПосле успешного завершения скрипта, мы увидим следующее:<pre lang="bash">test@serv:~$ sudo sh backup.sh[--------------------------------[2009-02-14--12-28]--------------------------------][----------][2009-02-14--12-28] Run the backup script...[++--------][2009-02-14--12-28] Generate a database backup...[++++------][2009-02-14--12-29] Backup database [images] - successfull.[++++++----][2009-02-14--12-29] Copy the source code project [itmages]...[++++++++--][2009-02-14--12-29] Copy the source code project [itmages] - successfull.[+++++++++-][2009-02-14--12-29] Stat datadir space (USED): 1,3G /home/test/backup[+++++++++-][2009-02-14--12-29] Free HDD space: 49G[++++++++++][2009-02-14--12-29] All operations completed successfully!test@serv:~$</pre>В итоге наши бэкапы складываются в каталог который вы указали, + резервные копии лежат в каталогах именованых по дате.via [Habr](http://habrahabr.ru/blogs/linux/51966/)
