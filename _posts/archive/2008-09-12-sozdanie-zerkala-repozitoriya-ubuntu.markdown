---
layout: post
title: Создание зеркала репозитория Ubuntu
wordpress_id: 293
wordpress_url: http://leopard.in.ua/?p=293
categories:
- ubuntu
tags:
- ubuntu
---
Я бы хотел поделится опытом создания зеркала, для репозитория дистрибутива Ubuntu.Причин по которым Вы захотите создать репозиторий может быть несколько: например у Вас нестабильно работающий или(и) медленный интернет и Вы бы хотели хранить репозиторий у себя на жестком диске, еще один вариант, это создание зеркала внутри локальной сети, именно так и поступил я и руководство будет для этого варианта.<!--more-->Итак для начала нам потребуется сам репозиторий, для закачки его на винчестер нам потребуется программа **debmirror**, установить ее можно через ваш любимый менеджер пакетов Adept или Synaptic, ну или через консоль . Здесь я буду приводить примеры для консоли, ну а с GUI Вы и сами разберетесь. Устанавливаем программу  debmirror<pre lang="bash">sudo apt-get install debmirror</pre>Теперь подготовим папку в которую будет закачан репозиторий<pre lang="bash">mkdir ubuntu</pre>Конечно же вы можете назвать папку как угодно.Теперь нам нужно создать скрипт, в этой самой папке, который собственно и будет закачивать репозиторий.<pre lang="bash">gedit archive.ubuntulinux.org.sh</pre>Скрипт должен содержать следующие строки<pre lang="bash">#!/bin/bash## Setting variables with explanations.# Arch=         -a      # Architecture. For Ubuntu can be i386, powerpc or amd64.# sparc, only starts in dapper, it is only the later models of sparc#arch=i386# Minimum Ubuntu system requires main, restricted# Section=      -s      # Section (One of the following - main/restricted/universe/multiverse).# You can add extra file with $Section/debian-installer. ex: main/debian-installer,universe/debian-installer,multiverse/debian-installer,restricted/debian-installer#section=main,restricted,universe,multiverse# Release=      -d      # Release of the system (Dapper, Edgy, Feisty, Gutsy, Hardy, Intrepid), and the -updates and -security ( -backports can be added if desired)#release=hardy,hardy-security,hardy-updates,hardy-backports# Server=       -h      # Server name, minus the protocol and the path at the end# CHANGE "*" to equal the mirror you want to create your mirror from. au. in Australia  ca. in Canada.# This can be found in your own /etc/apt/sources.list file, assuming you have Ubuntu installed.#server=archive.ubuntulinux.org# Dir=          -r      # Path from the main server, so http://my.web.server/$dir, Server dependant#inPath=/тут/пусть/к/папке/на сервере# Proto=        -e      # Protocol to use for transfer (http, ftp, hftp, rsync)# Choose one - http is most usual the service, and the service must be avaialbe on the server you point at.#proto=ftp# Outpath=              # Directory to store the mirror in# Make this a full path to where you want to mirror the material.#outPath=/тут/пусть/к/папке/ubuntu# The --nosource option only downloads debs and not deb-src's# The --progress option shows files as they are downloaded# --source \ in the place of --no-source \ if you want sources also.# --nocleanup  Do not clean up the local mirror after mirroring is complete. Use this option to keep older repository# Start script#debmirror       -a $arch \                --no-source \                -s $section \                -h $server \                -d $release \                -r $inPath \                --progress \                -e $proto \                $outPath</pre>Этот скрипт будет выкачивать репозиторий для версии Ubuntu 8.04. Наверное вы все заметили параметр —arch этот параметр указывает архитектуру для которой собраны пакеты Вы также можете установить значение параметра amd64.Сделать скрипт можно покороче, например так<pre lang="bash">#!/bin/bash -x/usr/bin/debmirror --nosource -m --passive --host=archive.ubuntulinux.org \--root=ubuntu --method=ftp --progress \--dist=hardy,hardy-security,hardy-updates,hardy-backports \--ignore-release-gpg --section=main,restricted,multiverse,universe \--arch=i386 /путь/к/папке/репозитория/</pre>Ну все теперь выполняем скрипт<pre lang="bash">./archive.ubuntulinux.org.sh</pre>Учтите что у меня например репозиторий занял около 22Гб (i386). Работу скрипта всегда можно завершить без каких либо последствий, а после следующего старта скрипта он проверит все md5 суммы пакетов и продолжит работу(учтите что проверка контрольных сумм занимает значительный ресурс процессора, так что по мере роста количества скачанных пакетов старайтесь реже прерывать работу скрипта)Ну вот теперь у вас на жестком диске лежит копия репозитория, если вы желаете добавить его в источники пакетов вам нужно прописать строку примерно следующего вида<pre lang="bash">deb file:///blablabla/ubuntu/ru.archive.ubuntu.com/ hardy main restricted multiverse universe</pre>Теперь собственно создание зеркала.Итак для зеркала нам понадобится WEB-сервер Apache. Для установки индейца наберите в терминале<pre lang="bash">sudo apt-get install apache2</pre>Установили? Запускаем и... ничего. Его еще нужно немного настроить, не бойтесь настроек там совсем немного.Большинство настроек хранятся в конфигурационном файле<pre lang="bash">/etc/apache2/apache2.conf</pre>открываем его для редактирования<pre lang="bash">sudo gedit /etc/apache2/apache2.conf</pre>Нужно указать Apache имена файлов которые он будет открывать по умолчанию, когда браузер обратится к вашему сайту. Этот шаг необязателен, он нужен нам будет для проверки работоспособности сервера. Добавляем строку<pre lang="bash">DirectoryIndex index.html index.phtml index.php</pre>Теперь можно проверить работоспособность сервера, запустив Apache и набрав в браузере свой IP адрес.Я еще добавил (на всякий случай) строку<pre lang="bash">DocumentRoot "/var/www/"</pre>Которая указывает на директорию в которой находится сайт. Вы можете указать директорию где находится репозиторий. Или можете просто скопировать содержимое репозитория в эту папку. Я вот сделал немного по другому, разместил репозиторий на отдельном разделе и примонтировал его в **/var/www/**.Все теперь удаляем файл **index.htm** из директории с сайтом и опять набираем в браузере свой адрес, там должен появится репозиторий.Для добавления репозитория в источники пакетов вам нужно прописать в файле **/etc/apt/sources.list** примерно следующее<pre lang="bash">deb http://Ваш IP адрес/ru.archive.ubuntu.com/ hardy main restricted multiverse universe</pre>Вот и все. Теперь у Вас есть зеркало обновлений для Ubuntu.
