---
layout: post
title: Nginx+PHP - это просто (Ubuntu)
wordpress_id: 272
wordpress_url: http://leopard.in.ua/?p=272
categories:
- PHP
- nginx
tags:
- PHP
- nginx
---
Итак, сегодня поведаю как настроить nginx с привязкой к PHP. Устанавливать будем на Ubuntu Server (подойдет и для Ubuntu, Debian). Сначала поставим nginx. Скачиваем стабильный пакет через wget:<pre lang="bash">wget http://technokracy.net/nginx/nginx_0.5.32~grrr-1_i386.deb</pre>Потом<pre lang="bash">sudo dpkg -i nginx_0.5.32~grrr-1_i386.deb</pre><!--more-->Теперь nginx установлени и работает по умолчанию на 8000 порту. Директория по умолчанию Nginx-default в каталоге /var/www/.Дальше отредактируем конфиг nginx.<pre lang="bash">vi /etc/nginx/sites-available/default</pre>Теперь ищем такие опции и раскоментим их (# - комент в конфиге), если их там нет - добавим<pre lang="bash">location ~ \.php$ {include /etc/nginx/fastcgi_params;fastcgi_pass  127.0.0.1:9000;fastcgi_index index.php;fastcgi_param  SCRIPT_FILENAME  /var/www/nginx-default$fastcgi_script_name;}</pre>Так мы обьяснили nginx что fcgi находится на порту 9000. Значит теперь нам надо запустить fcgi процесс. Я использую spawn-fcgi. Поставим теперь PHP:<pre lang="bash">apt-get install php5 php5-cli php5-cgi</pre>Теперь возьмем spawn-fcgi из lighttpd.<pre lang="bash">apt-get install lighttpd</pre>Теперь созданим скрипт для php-fastcgi:<pre lang="bash">touch /usr/bin/php-fastcgi</pre>И отредактируем<pre lang="bash">vi /usr/bin/php-fastcgi</pre>и добавим туда это<pre lang="bash">#!/bin/sh/usr/bin/spawn-fcgi -a 127.0.0.1 -p 9000 -u www-data -f /usr/bin/php5-cgi</pre>Каждый раз когда будет запущен этот скрипт, fcgi будет запущен на 9000 порт для юзер www-data.Теперь создадим скрипт для автоматического запуска php-fastcgi<pre lang="bash">touch /etc/init.d/init-fastcgi</pre>редактируем<pre lang="bash">vi /etc/init.d/init-fastcgi</pre><pre lang="bash">#!/bin/bashPHP_SCRIPT=/usr/bin/php-fastcgiRETVAL=0case "$1" in    start)      $PHP_SCRIPT      RETVAL=$?  ;;    stop)      killall -9 php      RETVAL=$?  ;;    restart)      killall -9 php      $PHP_SCRIPT      RETVAL=$?  ;;    *)      echo "Usage: php-fastcgi {start|stop|restart}"      exit 1  ;;esacexit $RETVAL</pre>Раздадим права на скрипты<pre lang="bash">chmod 755 /etc/init.d/init-fastcgichmod 755 /usr/bin/php-fastcgi</pre>Теперь проверяем скрипт<pre lang="bash">/etc/init.d/init-fastcgi start</pre>Добавляем в загрузку системы скрипт<pre lang="bash">update-rc.d init-fastcgi defaults</pre>И проверяем запущены ли процессы<pre lang="bash">ps ax | grep php</pre>Для проверки достаточно создать файл index.php, сбросить его в /var/www/nginx-default/ и записать туда<pre lang="php">&lt;? echo phpinfo(); ?&gt;</pre>Вы должны увидеть информационное окно PHP.Вот и все. Удачи!!!
